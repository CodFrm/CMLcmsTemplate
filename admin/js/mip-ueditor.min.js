(function(a){function b(){this.htmlStr="";this.htmlElement;this.computeStyle="";this.computeStyleArray=[];this.mipPage=""}b.prototype={constructor:b,setInternalHtml:function(e){this.destructObj();this.htmlStr=e},createXml:function(){var e=document.createElement("div");e.innerHTML=this.htmlStr;this.htmlElement=e},traversalDom:function(){var e=document.createNodeIterator(this.htmlElement,NodeFilter.SHOW_ELEMENT,null,false);var f=e.nextNode();while(f!==null){this.correctClass(f);f=e.nextNode()}},fuseMipHtml:function(e){if(!e){return}b.MipHtmlTool.filterHtml(e)},correctClass:function(g){if(!g){return}var h=g.getAttribute("style");if(h){var e=g.className;var f=this.createClassName(h);if(e){f=e+" "+f}g.className=f;this.addPageComputeStyle(h);this.removeDomStyle(g)}this.fuseMipHtml(g)},removeDomStyle:function(e){if(!e){return}e.removeAttribute("style")},addPageComputeStyle:function(e){if(!e){return}this.computeStyle+=this.createStyleForOne(e)},createStyleForOne:function(g){if(!g){return}var f=this.createClassName(g);if(this.computeStyleArray.indexOf(f)>=0){return""}this.computeStyleArray.push(f);var e="."+f;return e+"{"+g+"}"},createClassName:function(e){if(!e){return}return"mip-ueditor-ext-"+this.createHashName(e)},mergeStyle:function(e){this.computeStyle+=e},destructObj:function(){this.htmlStr="";this.htmlElement;this.computeStyle="";this.computeStyleArray=[];this.mipPage},createHashName:function(l){l+="";var g=[];var f=l.length;var e=Math.SQRT2.toFixed(9)-0;k(function(i){g[i]=0});for(var j=0;j<l.length;j++){h(l.charCodeAt(j))}k(function(i){g[i]=g[i].toString(16);if(g[i].length<2){g[i]="0"+g[i]}});g.reverse();return g.join("");function h(m){var n=m&255;var i=m>>8;k(function(o){var p=(o?g[o-1]:0)+g[o]+o+f+n;p+=(p/e).toFixed(9).slice(-3)-0;g[o]=p&255});if(i>0){h(i)}}function k(n){for(var m=0;m<16;m++){n(m)}}},setAllMip:function(){var e=["<!DOCTYPE html>","   <html mip>","       <head>",'           <meta charset="UTF-8">','               <meta name="viewport" content = "width=device-width,minimum-scale=1,initial-scale=1">',"               <title>MIP DEMO</title>",'               <link rel="stylesheet" type="text/css" href="https://mipcache.bdstatic.com/static/v1/mip.css">','               <link rel="canonical" href="https://www.baidu.com">',"               <style mip-custom>"+this.computeStyle+"</style>","       </head>","     <body>"+this.htmlElement.innerHTML+"",'       <script src="https://mipcache.bdstatic.com/static/v1/mip.js"><\/script>',"     </body>","   </html>"].join("");this.mipPage=e}};b.MipHtmlTool={transformMipimg:function(){var i=this;var e=b.MipHtmlTool;var j=i.getAttribute("src");var h=i.getAttribute("width")||"";var k=i.getAttribute("height")||"";if(!j){return}var g={"src":j,"responsive":"container"};if(h!==""&&k!==""){g["width"]=h;g["height"]=k}var f=document.createElement("mip-img");e.setAttribute.call(f,g);e.replaceDom.call(this,f)},transformMipa:function(){var h=this;var e=b.MipHtmlTool;var f=h.getAttribute("href");var j=h.getAttribute("title")||"";var i=h.innerHTML;if(!f){return}var g=document.createElement("mip-link");e.setAttribute.call(g,{"href":f,"title":j});g.innerHTML=i;e.replaceDom.call(this,g)},filterHtml:function(g){var h=["img","a"];var e=g.tagName.toLowerCase();if(h.indexOf(e)>=0){var f="transformMip"+e;this[f].call(g)}},replaceDom:function(e){this.parentNode.replaceChild(e,this)},setAttribute:function(f){for(var e in f){this.setAttribute(e,f[e])}}};var c=new b();function d(){var k=this;var h=[];var l="";k.fireEvent("getAllHtml",h);var j=k.document.getElementsByTagName("head")[0];var e=j.getElementsByTagName("style");for(var g=0;g<e.length;g++){var f=e[g];l+=f.innerHTML}return l}a.Editor.prototype.getMipContent=function(){var f=this.getContent();c.setInternalHtml(f);c.createXml();c.traversalDom();var e=d.call(this);c.mergeStyle(e);c.setAllMip();return{mipHtml:c.htmlElement.innerHTML,mipStyle:c.computeStyle,mipPage:c.mipPage}}})(UE);